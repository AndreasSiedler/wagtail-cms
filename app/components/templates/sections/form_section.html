{% extends "sections/section_base.html" %}
{% load wagtailcore_tags %}

{% block content %}
<!-- Features section -->
<section class="features-section pt-32 pb-32">
    <div class="container mx-auto">
        <h1 class="my-4 text-5xl font-bold leading-tight">{{ self.title }}</h1>
        <p class="leading-normal text-2xl mb-8">{{ self.intro|richtext }}</p>
        <form id="form-{{self.id}}" novalidate method='POST' action='.'
            data-url='{{ request.build_absolute_uri|safe }}'>
            {% csrf_token %}
            <input type="hidden" name="id" value={{self.id}}>
            {% for field in self.get_form.visible_fields %}
            <div>
                <div class="form-group mb-10">
                    <!-- <label class="block text-gray-700 text-sm font-bold mb-2" for="{{ field.id_for_label }}">
                        {{ field.label }}
                    </label> -->
                    <input type="{{ field.field.widget.input_type }}" placeholder="{{ field.label }}"
                        class="shadow appearance-none border border-red-500 rounded w-full py-6 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline"
                        name="{{ field.name }}" id="{{ field.id_for_label }}"
                        {% if field.field.required %}required="required" {% endif %}>
                    <p class="text-red-500 text-xs italic">Please choose a password.</p>

                    {% comment %}you might want form field for textarea or select etc. just make conditions for those
                    {% endcomment %}
                </div>
            </div>
            {% endfor %}
            {% include "buttons/button_action.html" %}

        </form>
    </div>
</section>

<!-- Features section end -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"
    integrity="sha512-BrvVYNhKh6yST24E5DY/LopLO5d+8KYmIXyrpBIJ2PK+CyyJw/cLSG/BfJomWLC1IblNrmiJWGlrGueKLd/Ekw=="
    crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        // console.log({{self.id}})
        var $myForm = $('#form-{{self.id}}')
        $myForm.submit(function (event) {
            console.log('FORM SUBMIT')
            event.preventDefault()
            var $formData = $(this).serialize()
            var $thisURL = $myForm.attr('data-url') || window.location.href // or set your own url
            $.ajax({
                method: "POST",
                url: $thisURL,
                data: $formData,
                success: handleFormSuccess,
                error: handleFormError,
            })
        })

        function handleFormSuccess(data, textStatus, jqXHR) {
            console.log(data)
            console.log(textStatus)
            console.log(jqXHR)
            $myForm[0].reset(); // reset form data
        }

        function handleFormError(jqXHR, textStatus, errorThrown) {
            // $myForm.find()
            // console.log($myForm);
            // console.log(jqXHR.responseJSON.errors)
            for (const [key, value] of Object.entries(jqXHR.responseJSON.errors)) {
                console.log($myForm.find(`#id_${key}`).next().text(value));
            }
            // console.log(textStatus)
            // console.log(errorThrown)

        }
    })
</script>
{% endblock %}

{% block extra_js %}
{# Override this in templates to add extra javascript #}

{% endblock %}